<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SPBBrewhaus</title>

</head>
<body>

<h2>SPBBrewhaus</h2>

<!-- Live Beer Tables -->
<div id="downstairs-table" style="margin-top:1rem;">Loading…</div>
<div id="upstairs-table"   style="margin-top:1rem;">Loading…</div>
<div id="ondeck-table"     style="margin-top:1rem;">Loading…</div>


<style>
/* Base */
html { font-size: 16px; }
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  margin: 20px;
  line-height: 1.45;
  color: #111;
}

/* Scale knobs */
:root{
  --title: 1.4rem;     /* page title (SPBBrewhaus) */
  --section: 1.2rem;   /* section headers (h3 like “Upstairs — On Tap”) */
  --content: 1.12rem;  /* tables & lists */
}

/* Headings */
h2 { color:#0b57d0; font-size: var(--title); margin:.25rem 0 .75rem; }
h3 { color:#0b57d0; font-size: var(--section); margin:.75rem 0 .35rem; }

/* Inventory blocks: make content match section scale */
#downstairs-table, #upstairs-table, #ondeck-table, #party-table {
  font-size: var(--content);   /* everything inside uses this size */
}

/* Make ALL children inherit exactly (th, td, strong, list items, etc.) */
#downstairs-table *, #upstairs-table *, #ondeck-table *, #party-table * {
  font-size: inherit !important;
}

/* Tables */
table { width:100%; border-collapse:collapse; margin-top:.6rem; }
th, td { border:1px solid #ddd; padding:6px 8px; text-align:left; vertical-align:top; }
th { background:#f5f3ee; font-weight:600; }

/* Lists inside <details> */
details > ul,
details > ol,
details > div > ul,
details > div > ol { list-style:disc !important; margin-left:1.5em !important; padding-left:1em !important; }
details li { display:list-item !important; list-style-type:disc !important; }

/* Muted text */
.muted { color:#666; font-style:italic; }

/* Optional: responsive gentle scaling */
@media (max-width: 420px){
  :root { --title: 1.35rem; --section: 1.18rem; --content: 1.1rem; }
}
</style>

<style>
/* Force table font size to match body text */
#downstairs-table table,
#upstairs-table table,
#ondeck-table table,
#party-table table {
  font-size: 1.1rem !important;   /* bump this up or down as needed */
}

/* Ensure header and cell text follow the same scale */
#downstairs-table th, #downstairs-table td,
#upstairs-table th, #upstairs-table td,
#ondeck-table th, #ondeck-table td,
#party-table th, #party-table td {
  font-size: inherit !important;
  line-height: 1.4;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // 🔁 Replace with your PUBLISHED-TO-WEB CSV URL for the main “Inventory” sheet
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTn3XrnFcps7_xm4HBCDfHCss0DB0Wwd5DRlXGxvE4hk9Nc_Hw8-6HuB6LS7p09BlOP44FhL_ByR1kQ/pub?output=csv";

  function parseCSV(text) {
    const out = []; let row = [], field = "", q = false;
    for (let i = 0; i < text.length; i++) {
      const c = text[i], n = text[i + 1];
      if (q) {
        if (c === '"' && n === '"') { field += '"'; i++; }
        else if (c === '"') q = false;
        else field += c;
      } else {
        if (c === '"') q = true;
        else if (c === ',') { row.push(field); field = ""; }
        else if (c === '\n' || c === '\r') {
          if (c === '\r' && n === '\n') i++;
          row.push(field); field = "";
          if (row.some(v => (v || "").trim() !== "")) out.push(row);
          row = [];
        } else field += c;
      }
    }
    if (field.length || row.length) { row.push(field); out.push(row); }
    return out;
  }

  function getStockIcon(status) {
    if (!status) return "";
    const s = status.toLowerCase();
    if (s.includes("good")) return " ✅";
    if (s.includes("low"))  return " 🟡";
    if (s.includes("out"))  return " ❌";
    return "";
  }

  function buildTable(rows) {
    let html = `<table><thead><tr>
      <th>Tap</th>
      <th>Beer + Status</th>
      <th>1/2 bbl</th>
      <th>1/6 bbl</th>
      <th>Cases of Cans</th>
    </tr></thead><tbody>`;

    for (const r of rows) {
      const icon  = getStockIcon(r.stock);
      const notes = r.notes ? `<div class="muted">${r.notes}</div>` : "";
      html += `<tr>
        <td>${r.tap || ""}</td>
        <td><strong>${r.beer || ""}${icon}</strong>${r.status ? " — " + r.status : ""}${notes}</td>
        <td>${r.half || ""}</td>
        <td>${r.sixth || ""}</td>
        <td>${r.cans || ""}</td>
      </tr>`;
    }
    html += `</tbody></table>`;
    return html;
  }

  function normalize(str) { return (str || "").toLowerCase().replace(/\s+/g, " ").trim(); }

  async function render() {
    const upEl   = document.getElementById("upstairs-table");
    const downEl = document.getElementById("downstairs-table");
    const deckEl = document.getElementById("ondeck-table");

    try {
      const res  = await fetch(CSV_URL, { cache: "no-cache", mode: "cors" });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const rows = parseCSV(await res.text());
      if (!rows.length) throw new Error("Empty CSV");

      const header = rows[0].map(h => normalize(h));
      const gi = (name) => header.indexOf(name);

      const idx = {
        location: gi("location"),
        tap: gi("tap"),
        beer: gi("beer"),
        status: gi("status"),
        half: gi("1/2 bbl"),
        sixth: gi("1/6 bbl"),
        cans: gi("cases of cans"),
        stock: gi("stock status"),
        notes: gi("notes"),
      };

      const data = rows.slice(1).map(r => ({
        location: r[idx.location] || "",
        tap:      r[idx.tap] || "",
        beer:     r[idx.beer] || "",
        status:   r[idx.status] || "",
        half:     r[idx.half] || "",
        sixth:    r[idx.sixth] || "",
        cans:     r[idx.cans] || "",
        stock:    r[idx.stock] || "",
        notes:    r[idx.notes] || "",
      }));

      // Make location matching very forgiving
      const isUp   = (s) => /up|upstairs/i.test(s);
      const isDown = (s) => /down|downstairs/i.test(s);
      const isDeck = (s) => /deck/i.test(s);

      const upstairs   = data.filter(x => isUp(x.location));
      const downstairs = data.filter(x => isDown(x.location));
      const ondeck     = data.filter(x => isDeck(x.location));

      upEl.innerHTML   = `<h3>Upstairs — On Tap</h3>`   + (upstairs.length   ? buildTable(upstairs)   : `<div class="muted">No rows found.</div>`);
      downEl.innerHTML = `<h3>Downstairs — On Tap</h3>` + (downstairs.length ? buildTable(downstairs) : `<div class="muted">No rows found.</div>`);
      deckEl.innerHTML = `<h3>On Deck</h3>`             + (ondeck.length     ? buildTable(ondeck)     : `<div class="muted">No rows found.</div>`);
    } catch (e) {
      console.error(e);
      upEl.textContent   = "Failed to load inventory.";
      downEl.textContent = "Failed to load inventory.";
      deckEl.textContent = "Failed to load inventory.";
    }
  }

  render();
});
</script>

<p>
  <a href="https://docs.google.com/spreadsheets/d/13-oglKrmnpkJok_xEO7brLNmnetRz3XIkrc2gSXf4X0/edit?usp=sharing" target="_blank">🔐 Staff Login to Update Inventory</a>
</p>
<p class="muted">Note: updates appear automatically on this page after saving the sheet.</p>

<h3>🪖 In the Tanks</h3>
<ul>
  <li>Tank 3 → S'mores</li>
  <li>Tank 7 → Restitution</li>
  <li>Tank 8 → Scottie Pumpkin</li>
  <li>Available tanks: 1, 2, 4, 5, 6</li>
</ul>

<h3>🛠 To Brew</h3>
<ul>
  <li>Winter’s Knight</li><li>Cranberry Saison</li><li>Super Haze</li>
  <li>Seltzer × 4</li><li>NY Saaz</li><li>NY IPA</li>
</ul>

<h3>⚗️ Chemicals</h3>
<ul>
  <li>PAA: 50% with 2 backup</li>
  <li>CAUSTIC: 15% with 1 backup</li>
  <li>FOAMING CAUSTIC: 80%</li>
  <li>LP acid 25% with 1 backup</li>
  <li>Glycol 40%</li>
</ul>

<h3>Gas levels</h3>
<ul>
  <li>CO2 118 psi</li>
  <li>Nitrogen 1600 psi (No back-up)</li>
  <li>Oxygen 900 psi</li>
  <li>2× small CO2 tanks</li>
</ul>

<details>
  <summary>🔮 Future Maintenance</summary>
  <div markdown="1">
    <ul>
      <li>New water barrier</li>
      <li>Fix Water Softener (If not already working)</li>
      <li>Paint floors</li>
      <li>Glycol chiller pump is currently bypass; need new set of fuses</li>
      <li>Update 5/27: received fuses, waiting to install</li>
    </ul>
  </div>
</details>

<br />

<details>
  <summary>📄 Orders</summary>
  <div markdown="1">
    <ul>
      <li><strong>Eagle (10/03):</strong> Restitution — 16 kegs, 12 sixels DONE</li>
    </ul>
  </div>
</details>

<br />

<details>
  <summary>🧻 Labels Needed</summary>
  <div markdown="1">
    <p><strong>Upcoming Brews</strong></p>
    <ul><li>Winter’s Knight</li><li>Super Haze</li></ul>
    <p><strong>Inventory</strong></p>
    <ul>
      <li>Boston South Irish Stout</li><li>S’mores</li><li>New West Coast</li>
      <li>Founders Sept</li><li>Cherry Pineapple Sour</li>
    </ul>
  </div>
</details>

<br />

<details>
  <summary>📦 Ingredients</summary>
  <div markdown="1">
    <p><strong>Needed</strong></p>
    <ul><li>Galaxy — 44 lbs</li><li>Amarillo — 44 lbs</li></ul>

    <details>
      <summary>🌿 Hops On Hand</summary>
      <div markdown="1">
        <p><strong>A–C</strong></p>
        <ul>
          <li>Amarillo — (5 lbs)</li><li>Azacca — (33 lbs)</li>
          <li>Centennial — (221 lbs)</li><li>Chinook — (5 lbs)</li><li>Citra — (80 lbs)</li>
        </ul>
        <p><strong>D–N</strong></p>
        <ul>
          <li>El Dorado — (27 lbs)</li><li>Mandarina — (5 lbs)</li>
          <li>Nugget — (27 lbs)</li><li>NY Chinook — (11 lbs)</li>
        </ul>
        <p><strong>S–Z</strong></p>
        <ul>
          <li>Saaz — (11 lbs)</li><li>Simcoe — (33 lbs)</li><li>Vallestia — (38 lbs)</li>
          <li>Warrior — (5 lbs)</li><li>Zeus — (33 lbs)</li><li>32 DE 2021 — (11 lbs)</li>
        </ul>
      </div>
    </details>
  </div>
</details>

<br />

<details>
  <summary>⚙️ Maintenance & Logs</summary>
  <div markdown="1">
    <div id="maintenance" style="margin-top:.75rem;">Loading maintenance…</div>

    <script>
    (function () {
      // 🔁 Replace with the PUBLISHED-TO-WEB CSV URL for your “Maintenance” tab (correct gid)
      const MAINT_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTn3XrnFcps7_xm4HBCDfHCss0DB0Wwd5DRlXGxvE4hk9Nc_Hw8-6HuB6LS7p09BlOP44FhL_ByR1kQ/pub?gid=2038532004&single=true&output=csv";

      const csvParse = (typeof window.parseCSV === "function") ? window.parseCSV : function (text) {
        const out = []; let row = [], field = "", q = false;
        for (let i=0;i<text.length;i++){
          const c=text[i], n=text[i+1];
          if(q){ if(c==='"'&&n==='"'){field+='"';i++;} else if(c==='"'){q=false;} else {field+=c;} }
          else { if(c==='"'){q=true;}
            else if(c===','){row.push(field); field="";}
            else if(c==='\n'||c==='\r'){ if(c==='\r'&&n==='\n') i++; row.push(field); field=""; if(row.some(v=>(v||"").trim()!=="")) out.push(row); row=[];}
            else {field+=c;}
          }
        }
        if(field.length||row.length){ row.push(field); out.push(row); }
        return out;
      };

      function buildTable(rows, iDate, iEvent) {
        let html = `<table><thead><tr><th>Date</th><th>Event</th></tr></thead><tbody>`;
        for (const r of rows) {
          html += `<tr><td>${r[iDate]||""}</td><td>${r[iEvent]||""}</td></tr>`;
        }
        html += `</tbody></table>`;
        return html;
      }

      async function renderMaintenance() {
        try {
          const res = await fetch(MAINT_CSV_URL, { cache: "no-cache", mode: "cors" });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const rows = csvParse(await res.text());
          if (!rows.length) throw new Error("Empty CSV");

          const header = rows[0].map(h => (h||"").trim().toLowerCase());
          const iSys   = header.indexOf("system");
          const iDate  = header.indexOf("date");
          const iEvent = header.indexOf("event");

          if (iSys < 0 || iDate < 0 || iEvent < 0) {
            document.getElementById("maintenance").innerHTML =
              "<em>Expected headers: System, Date, Event.</em>";
            return;
          }

          const data = rows.slice(1).filter(r => r.some(v => (v||"").trim() !== ""));
          const groups = {};
          for (const r of data) {
            const key = (r[iSys] || "Other").trim();
            (groups[key] ||= []).push(r);
          }

          for (const key of Object.keys(groups)) {
            groups[key].sort((a,b) => {
              const da = new Date(a[iDate]), db = new Date(b[iDate]);
              return (isNaN(db) - isNaN(da)) || (db - da);
            });
          }

          let html = "";
          for (const [sys, list] of Object.entries(groups)) {
            html += `<h3 style="margin:.6rem 0 .3rem">${sys} Log</h3>`;
            html += buildTable(list, iDate, iEvent);
          }
          document.getElementById("maintenance").innerHTML = html || "<em>No maintenance rows yet.</em>";
        } catch (e) {
          console.error(e);
          document.getElementById("maintenance").textContent = "Failed to load maintenance log.";
        }
      }

      renderMaintenance();
    })();
    </script>

    <p>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSeMIzh7LHuZMFyK7xNuJIg30oSsXO_VFRJEswS-piHc_RX37A/viewform" target="_blank">🔐 Staff Link to fill out form</a>
    </p>
    <p class="muted">Note: updates appear automatically on this page after saving the sheet.</p>
  </div>
</details>

</body>
</html>